<p class="bookmark-instructions" data-bind="visible: game().PlayerGuid">Hello {{game().PlayerName}}, don't forget to bookmark this URL!</p>

<h3>Game setup</h3>
<p>
    This is a {{game().GameSize}} player game with the following characters    
    <span class="important" data-bind="visible: game().CharactersMissing">({{game().CharactersMissing}} still to be added)</span>
</p>


<ul class="cards" data-bind="foreach: game().CharactersInGame">
    <li>
        <img class="card" data-bind="attr: { src: '/Images/' + $data + '.png', title: $data }" alt="{{$data}" /></li>
</ul>

<div class="clear"></div>

<ul class="round-table" data-bind="foreach: game().RoundTables">
    <li>Round {{$index() + 1}} needs {{TeamSize}} players and {{RequiredFails}} fail(s)</li>
</ul>

<div data-bind="visible: game().PlayerInfo">
    <h3>Oracle</h3>
    <p>Mouse over each player card to see information you may know about them.</p>
    <ul class="cards" data-bind="foreach: game().PlayerInfo">
        <li>
            <img class="playercard" src="/Images/player.png" data-actual="/images/@(p.Actual).png" />
            <div class="playername">
                {{Name}}
               <!-- @if (Model.ImpersonationList != null && Model.ImpersonationList.Count > 0)
=======
			<img class="playercard" src="/Images/@(Model.GameOver?p.Actual:"player").png"
                 data-hoverenabled="@((!Model.GameOver).ToString())" 
                data-actual="/images/@(p.Actual).png"
                 title="@(p.Actual == "Player" ? "" : p.Actual.Humanize())" />
            <div class="playername">
                @if (Model.ImpersonationList != null && Model.ImpersonationList.Count > 0)
>>>>>>> more knockout
=======
			<img class="playercard" src="/Images/player.png" data-actual="/images/@(p.Actual).png" />
            <div class="playername">{{Name}}
               <!-- @if (Model.ImpersonationList != null && Model.ImpersonationList.Count > 0)
>>>>>>> home page working
                {
                    @Html.ActionLink(p.Name, "Game", new { gameId = Model.GameId, playerGuid = Model.ImpersonationList.First(i => i.Name == p.Name).Guid })
                }
                else
                {
                    @p.Name
                }-->
            </div>
        </li>
    </ul>
</div>

<!--@section scripts {
<script>
    $(function () {
        //show extra info on mouse over
        $(".playercard").hover(function () {
            var old = $(this).attr('src');
            $(this).attr('src', $(this).attr('data-actual'));
            $(this).attr('data-actual', old);
        }, function () {
            var old = $(this).attr('src');
            $(this).attr('src', $(this).attr('data-actual'));
            $(this).attr('data-actual', old);
        });
        //show extra info on click for touchscreen devices
        $(".playercard").click(function () {
            $(this).unbind("mouseenter mouseleave");
            var old = $(this).attr('src');
            $(this).attr('src', $(this).attr('data-actual'));
            $(this).attr('data-actual', old);
        });
    });
</script>
}
}-->

<div class="clear"></div>


<div data-bind="foreach: game().Rounds">
    <h3>Round {{ $index() + 1 }}        
        <img title="{{Outcome}}" data-bind="visible: Outcome, attr: { src: '/images/' + Outcome() + '.png' }" />
    </h3>

    <div data-bind="foreach: Teams">

        <div class="quest">
            <div class="setup">
                <ul class="cards">
                    <li>
                        <img src="/Images/leadertoken.png" title="@team.Leader" />
                        <div class="playername">{{Leader}}</div>
                    </li>

                    <!-- ko foreach: TeamMembers -->
                    <li>
                        <img src="/Images/teamtoken.png" title="{{$data}}" />
                        <div class="playername">{{$data}}</div>
                    </li>

                    <!-- /ko -->
                    <!-- ko foreach: Vote -->
                    <li>
                        <img class="vote" title="{{Player}}" data-bind="attr: { src: '/images/' + Image() + '.png' }" />
                        <div class="playername">{{Player}}</div>
                    </li>
                    <!-- /ko -->

                </ul>
                <!--@if (Model.Rounds.IndexOf(round) + 1 == Model.Rounds.Count && Model.Waiting.Where(w => w.Action == ResistanceOnline.Core.Action.Type.AddToTeam).Any())
                {
                        <span class="waiting">Waiting for @Model.CommaQuibbling(Model.Waiting.Where(w => w.Action == ResistanceOnline.Core.Action.Type.AddToTeam).Select(w => w.Name)) to choose the team</span>
                }
                @if (Model.Rounds.IndexOf(round) + 1 == Model.Rounds.Count && Model.Waiting.Where(w => w.Action == ResistanceOnline.Core.Action.Type.VoteForTeam).Any())
                {
                    <span class="waiting">Waiting for @Model.CommaQuibbling(Model.Waiting.Where(w => w.Action == ResistanceOnline.Core.Action.Type.VoteForTeam).Select(w => w.Name)) to vote</span>
                }-->
            </div>
            <div class="clear"></div>
            <div class="results">
                <ul class="cards" data-bind="foreach: QuestCards">
                    <li>
                        <img class="card" data-bind="attr: { src: '/images/' + Image() + '.png' }" />
                    </li>
                </ul>
                <!-- @if (Model.Rounds.IndexOf(round) + 1 == Model.Rounds.Count && Model.Waiting.Where(w => w.Action == ResistanceOnline.Core.Action.Type.SubmitQuestCard).Any())
                {
                    <span class="waiting">Waiting for @Model.CommaQuibbling(Model.Waiting.Where(w => w.Action == ResistanceOnline.Core.Action.Type.SubmitQuestCard).Select(w => w.Name)) to quest</span>
                }-->
            </div>
            <div class="clear"></div>
            @if (Model.Rounds.IndexOf(round) + 1 == Model.Rounds.Count && Model.Waiting.Where(w => w.Action == ResistanceOnline.Core.Action.Type.UseTheLadyOfTheLake).Any())
            {
                <span class="waiting">Waiting for @Model.CommaQuibbling(Model.Waiting.Where(w => w.Action == ResistanceOnline.Core.Action.Type.VoteForTeam).Select(w => w.Name)) to use the lady of the lake</span>
            }
        </div>
    </div>
</div>

<div data-bind="visible: game().GameOver">
    <h3>Game Over</h3>
    <p>{{game().GameState}}</p>
</div>

<h1>Actions</h1>
<ul data-bind="foreach: game().Actions">
    <li>
        <!--todo find nicer syntax for this-->
        <div data-bind="compose: { model: '/app/widgets/' + $data + '.js', view: '/app/widgets/' + $data + '.html', activationData: $root.game }"></div>
    </li>
</ul>
