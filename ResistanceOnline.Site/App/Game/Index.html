<p class="bookmark-instructions" data-bind="visible: game().PlayerGuid">Hello {{game().PlayerName}}, don't forget to bookmark this URL!</p>

<h3>Game setup</h3>
<p>
    This is a {{game().GameSize}} player game with the following characters    
    <span class="important" data-bind="visible: game().CharactersMissing">({{game().CharactersMissing}} still to be added)</span>    
</p>

<ul class="cards" data-bind="foreach: game().CharactersInGame">
    <li><img class="card" data-bind="attr: { src: '/Images/' + $data + '.png', title: $data }" alt="{{$data}"  /></li>	
</ul>

<div class="clear"></div>    

<ul class="round-table" data-bind="foreach: game().RoundTables">
    <li>Round {{$index() + 1}} needs {{TeamSize}} players and {{RequiredFails}} fail(s)</li>    
</ul>

<div data-bind="visible: game().PlayerInfo">
    <h3>Oracle</h3>
    <p>Mouse over each player card to see information you may know about them.</p>    
    <ul class="cards" data-bind="foreach: game().PlayerInfo">
		<li>
            <!--todo make clickable-->
			<img class="playercard" src="/Images/player.png"  data-bind="attr: { data_actual: '/images/' + $data + '.png' }, click: function () { var old = $(this).attr('src'); $(this).attr('src', $(this).attr('data-actual')); $(this).attr('data-actual', old); }" />
            <div class="playername">{{Name}}</div>
		</li>
    </ul>
    <!--todo show all-->
</div>

<div class="clear"></div>

<div data-bind="foreach: game().Rounds">
	<h3>
        Round {{ $index() + 1 }}        
        <img  title="{{Outcome}}" data-bind="visible: Outcome, attr: { src: '/images/' + Outcome() + '.png' }" />
    </h3>
    <p>{{TeamSize}} player(s) ({{FailsRequired}} fail(s) required)</p>
	
    <div data-bind="foreach: Teams">
		<div class="quest">
            <div class="setup">
                <ul class="cards">
                    <li>
                        <img src="/Images/leadertoken.png" title="@team.Leader" />
                        <div class="playername">{{Leader}}</div>
                    </li>

                    <!-- ko foreach: TeamMembers -->
                        <li>
                            <img src="/Images/teamtoken.png" title="{{$data}}" />
                            <div class="playername">{{$data}}</div>
                        </li>
                    
                    <!-- /ko -->
                     <!-- ko foreach: Vote -->
                        <li>
                            <img class="vote" title="{{Player}}" data-bind="attr: { src: '/images/' + Image() + '.png' }" />
                            <div class="playername">{{Player}}</div>
                        </li>
                    <!-- /ko -->

                </ul>

                 <pre data-bind="text: ko.toJSON($root.Waiting, null, 2)"></pre>
            </div>
            <div class="clear"></div>
            <div class="results">
                <ul class="cards" data-bind="foreach: QuestCards">                    
                    <li> 
                        <img class="card" data-bind="attr: { src: '/images/' + Image() + '.png' }" />
                    </li>                    
                </ul>

                <!--todo waiting for...-->
                 <!--<pre data-bind="text: ko.toJSON(game.Waiting, null, 2)"></pre>-->
            </div>
            <div class="clear"></div>

            <!--todo waiting for...-->
            <!--<pre data-bind="text: ko.toJSON(game.Waiting, null, 2)"></pre>-->

		</div>
	</div>          
</div>


            <pre data-bind="text: ko.toJSON(game().state, null, 2)"></pre>
        <pre data-bind="text: ko.toJSON(game().AssassinsGuessAtMerlin, null, 2)"></pre>

<!--@if (Model.GameState == ResistanceOnline.Core.game().State.GuessingMerlin || Model.AssassinsGuessAtMerlin != null)
{
    <h3>Assassination Attempt</h3>    
    if (Model.AssassinsGuessAtMerlin == null)
    {
        <span class="waiting">Waiting for @(Model.Waiting.First(w => w.Action == ResistanceOnline.Core.Action.Type.GuessMerlin).Name) to guess Merlin</span>
    }
    else
    {
        <ul class="cards">
        <li>
            <img src="/Images/@(Model.AssassinsGuessAtMerlin.Character).png" title="@(Model.AssassinsGuessAtMerlin.Character.Humanize())" />
            <div class="playername">@Model.AssassinsGuessAtMerlin.Name</div>
        </li>
        </ul>
        <span class="result">@(Model.AssassinsGuessAtMerlin.Character == ResistanceOnline.Core.Character.Merlin ? "Merlin has been assassinated" : "Casualty of war")</span>
        <div class="clear"></div>
    }
}-->

<div data-bind="visible: game().GameOver">
    <h3>Game Over</h3>
    <p>{{game().GameState}}</p>
</div>

<h1>Actions</h1>
<ul data-bind="foreach: game().Actions">
    <li >
        <h2>{{$data}}</h2>
        <!--todo find nicer syntax for this-->
        <div data-bind="compose: { model: '/app/widgets/' + $data + '.js', view: '/app/widgets/' + $data + '.html', activationData: $root.game }"></div>
    </li>
</ul>


            <!--
                see gamestate for debuggings
                <pre data-bind="text: ko.toJSON($data, null, 2)"></pre>
                -->
