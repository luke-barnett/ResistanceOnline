<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
=======
>>>>>>> knockouts
﻿@{

	ViewBag.Title = "Game " + Model.GameId;
}
<<<<<<< HEAD
<<<<<<< HEAD
=======

<p class="bookmark-instructions" data-bind="visible: game.PlayerGuid">Hello {{game.PlayerName}}, don't forget to bookmark this URL!</p>

=======
﻿<p class="bookmark-instructions" data-bind="visible: game().PlayerGuid">Hello {{game().PlayerName}}, don't forget to bookmark this URL!</p>
>>>>>>> more knockout

>>>>>>> knockouts
<h3>Game setup</h3>
<p>
    This is a {{game().GameSize}} player game with the following characters    
    <span class="important" data-bind="visible: game().CharactersMissing">({{game().CharactersMissing}} still to be added)</span>    
</p>


<ul class="cards" data-bind="foreach: game().CharactersInGame">
    <li><img class="card" data-bind="attr: { src: '/Images/' + $data + '.png', title: $data }" alt="{{$data}"  /></li>	
</ul>

<div class="clear"></div>    

<ul class="round-table" data-bind="foreach: game().RoundTables">
    <li>Round {{$index() + 1}} needs {{TeamSize}} players and {{RequiredFails}} fail(s)</li>    
</ul>
@if (Model.PlayersMissing>0)
{
    <p>Waiting for @("more player".ToQuantity(Model.PlayersMissing, ShowQuantityAs.Words))</p>
    if (Model.PlayerGuid.HasValue)
=======

<p class="bookmark-instructions" data-bind="visible: game.PlayerGuid">Hello {{game.PlayerName}}, don't forget to bookmark this URL!</p>

=======
﻿<p class="bookmark-instructions" data-bind="visible: game().PlayerGuid">Hello {{game().PlayerName}}, don't forget to bookmark this URL!</p>
>>>>>>> more knockout

<h3>Game setup</h3>
<p>
    This is a {{game().GameSize}} player game with the following characters    
    <span class="important" data-bind="visible: game().CharactersMissing">({{game().CharactersMissing}} still to be added)</span>    
</p>


<ul class="cards" data-bind="foreach: game().CharactersInGame">
    <li><img class="card" data-bind="attr: { src: '/Images/' + $data + '.png' }" alt="{{$data}" title="{{$data}}" /></li>	
</ul>

<div class="clear"></div>    

<<<<<<< HEAD
<ul class="round-table">
    @for (int i = 0; i < Model.RoundTables.Count; i++)
>>>>>>> knockouts
    {
        <form role="form" action="/AddComputerPlayer" method="post">
            <input type="hidden" name="gameid" value="@Model.GameId" />
            <input type="hidden" name="playerGuid" value="@Model.PlayerGuid" />
            <div class="form-group">
                <input class="form-control" type="text" name="name" placeholder="Enter a computer player name" />
                <select name="bot">
                    <option value="simplebot">Simple Bot</option>
                    <option value="trustbot">Trust Bot</option>
                    <option value="trustbot">Cheat Bot</option>
                </select>
            </div>
            <input class="btn btn-default" type="submit" value="Add Computer Player" />
        </form>
    }
}

<div data-bind="visible: game().PlayerInfo.length">
=======
<ul class="round-table" data-bind="foreach: game().RoundTables">
    <li>Round {{$index() + 1}} needs {{TeamSize}} players and {{RequiredFails}} fail(s)</li>    
</ul>

<div data-bind="visible: game().PlayerInfo">
>>>>>>> more knockout
    <h3>Oracle</h3>
    <p>Mouse over each player card to see information you may know about them.</p>    
    <ul class="cards" data-bind="foreach: game().PlayerInfo">
		<li>
<<<<<<< HEAD
			<img class="playercard" src="/Images/player.png" data-actual="/images/@(p.Actual).png" />
            <div class="playername">{{Name}}
               <!-- @if (Model.ImpersonationList != null && Model.ImpersonationList.Count > 0)
=======
			<img class="playercard" src="/Images/@(Model.GameOver?p.Actual:"player").png"
                 data-hoverenabled="@((!Model.GameOver).ToString())" 
                data-actual="/images/@(p.Actual).png"
                 title="@(p.Actual == "Player" ? "" : p.Actual.Humanize())" />
            <div class="playername">
                @if (Model.ImpersonationList != null && Model.ImpersonationList.Count > 0)
>>>>>>> more knockout
                {
                    @Html.ActionLink(p.Name, "Game", new { gameId = Model.GameId, playerGuid = Model.ImpersonationList.First(i => i.Name == p.Name).Guid })
                }
                else
                {
                    @p.Name
                }-->
            </div>
		</li>
    </ul>
<<<<<<< HEAD
    SHOW ALL TODO
=======
>>>>>>> more knockout
</div>

<!--@section scripts {
<script>
    $(function () {
        //show extra info on mouse over
        $(".playercard").hover(function () {
            var old = $(this).attr('src');
            $(this).attr('src', $(this).attr('data-actual'));
            $(this).attr('data-actual', old);
        }, function () {
            var old = $(this).attr('src');
            $(this).attr('src', $(this).attr('data-actual'));
            $(this).attr('data-actual', old);
        });
        //show extra info on click for touchscreen devices
        $(".playercard").click(function () {
            $(this).unbind("mouseenter mouseleave");
            var old = $(this).attr('src');
            $(this).attr('src', $(this).attr('data-actual'));
            $(this).attr('data-actual', old);
        });
    });
</script>
}
}-->

<div class="clear"></div>


<div data-bind="foreach: game().Rounds">
	<h3>
        Round {{ $index() + 1 }}        
<<<<<<< HEAD
        <img  title="{{Outcome}}" data-bind="visible: Outcome, attr: {src: '/images/' + Outcome() + '.png' }" />
    </h3>
    <p>{{TeamSize}} player(s) ({{FailsRequired}} fail(s) required)</p>
=======
        <!--<img  title="{{Outcome}}" data-bind="visible: Outcome, attr: {src: '/images/' + Outcome() + '}}.png' }" />-->
    </h3>
    <p>{{TeamSize}} player(s) ({{RequiredFails}} fail(s) required)</p>
>>>>>>> more knockout
	
    <div data-bind="foreach: Teams">
	
		<div class="quest">
            <div class="setup">
                <ul class="cards">
                    <li>
                        <img src="/Images/leadertoken.png" title="@team.Leader" />
                        <div class="playername">{{Leader}}</div>
                    </li>

                    <!-- ko foreach: TeamMembers -->
                        <li>
                            <img src="/Images/teamtoken.png" title="{{$data}}" />
                            <div class="playername">{{$data}}</div>
                        </li>
                    
                    <!-- /ko -->
                     <!-- ko foreach: Vote -->
                        <li>
                            <img class="vote" title="{{Player}}" data-bind="attr: {src: '/images/' + Image() + '.png' }" />
                            <div class="playername">{{Player}}</div>
                        </li>
                    <!-- /ko -->

                </ul>
                <!--@if (Model.Rounds.IndexOf(round) + 1 == Model.Rounds.Count && Model.Waiting.Where(w => w.Action == ResistanceOnline.Core.Action.Type.AddToTeam).Any())
                {
                        <span class="waiting">Waiting for @Model.CommaQuibbling(Model.Waiting.Where(w => w.Action == ResistanceOnline.Core.Action.Type.AddToTeam).Select(w => w.Name)) to choose the team</span>
                }
                @if (Model.Rounds.IndexOf(round) + 1 == Model.Rounds.Count && Model.Waiting.Where(w => w.Action == ResistanceOnline.Core.Action.Type.VoteForTeam).Any())
                {
                    <span class="waiting">Waiting for @Model.CommaQuibbling(Model.Waiting.Where(w => w.Action == ResistanceOnline.Core.Action.Type.VoteForTeam).Select(w => w.Name)) to vote</span>
                }-->
            </div>
            <div class="clear"></div>
            <div class="results">
                <ul class="cards" data-bind="foreach: QuestCards">                    
<<<<<<< HEAD
                    <li> 
                        <img class="card" data-bind="attr: { src: '/images/' + Image() + '.png' }" />
=======
                    <li>
                        <img class="card" src="/images/@(card.Image).png" />
>>>>>>> more knockout
                    </li>                    
                </ul>
               <!-- @if (Model.Rounds.IndexOf(round) + 1 == Model.Rounds.Count && Model.Waiting.Where(w => w.Action == ResistanceOnline.Core.Action.Type.SubmitQuestCard).Any())
                {
                    <span class="waiting">Waiting for @Model.CommaQuibbling(Model.Waiting.Where(w => w.Action == ResistanceOnline.Core.Action.Type.SubmitQuestCard).Select(w => w.Name)) to quest</span>
                }-->
            </div>
            <div class="clear"></div>
            @if (Model.Rounds.IndexOf(round) + 1 == Model.Rounds.Count && Model.Waiting.Where(w => w.Action == ResistanceOnline.Core.Action.Type.UseTheLadyOfTheLake).Any())
            {
                <span class="waiting">Waiting for @Model.CommaQuibbling(Model.Waiting.Where(w => w.Action == ResistanceOnline.Core.Action.Type.VoteForTeam).Select(w => w.Name)) to use the lady of the lake</span>
            }
		</div>
	</div>          
</div>

<<<<<<< HEAD
<!--@if (Model.GameState == ResistanceOnline.Core.game().State.GuessingMerlin || Model.AssassinsGuessAtMerlin != null)
=======
@if (Model.GameState == ResistanceOnline.Core.game().State.GuessingMerlin || Model.AssassinsGuessAtMerlin != null)
>>>>>>> more knockout
{
    <h3>Assassination Attempt</h3>    
    if (Model.AssassinsGuessAtMerlin == null && Model.AssassinIsInTheGame)
    {
        <span class="waiting">Waiting for @(Model.Waiting.First(w => w.Action == ResistanceOnline.Core.Action.Type.GuessMerlin).Name) to guess Merlin</span>
    }
    else
    {
        <ul class="cards">
        <li>
            <img src="/Images/@(Model.AssassinsGuessAtMerlin.Character).png" title="@(Model.AssassinsGuessAtMerlin.Character.Humanize())" />
            <div class="playername">@Model.AssassinsGuessAtMerlin.Name</div>
        </li>
        </ul>
        <span class="result">@(Model.AssassinsGuessAtMerlin.Character == ResistanceOnline.Core.Character.Merlin ? "Merlin has been assassinated" : "Casualty of war")</span>
        <div class="clear"></div>
    }
}-->

<div data-bind="visible: game().GameOver">
    <h3>Game Over</h3>
<<<<<<< HEAD
    <p>{{game().GameState}}</p>
</div>

<h1>Actions</h1>
<ul data-bind="foreach: game().Actions">
    <li >
        <!--todo find nicer syntax for this-->
        <div data-bind="compose: { model: '/app/widgets/' + $data + '.js', view: '/app/widgets/' + $data + '.html', activationData: $root.game }"></div>
    </li>
<<<<<<< HEAD
=======
    <p>{{GameState}}</p>
</div>

<h1>Actions</h1>
<!--
<form role="form" action="/AddCharacter" method="post" data-bind="visible: game().Actions">.Contains(1)@ResistanceOnline.Core.Action.Type.AddCharacter
    <input type="hidden" name="gameid" value="@Model.GameId" />
    <input type="hidden" name="playerGuid" value="@Model.PlayerGuid" />
    <div class="form-group">
        @Html.DropDownList("Character", Model.AllCharactersSelectList, new { @class = "form-control" })
    </div>
    <input class="btn btn-default" type="submit" value="Add Character" />
</form>-->

<ul data-bind="foreach: Actions">
    <li>{{$data}}</li>
>>>>>>> more knockout
</ul>

<!--@if (Model.Actions.Count>0) { 
	if (Model.Actions.Contains(ResistanceOnline.Core.Action.Type.GuessMerlin))
	{
		<form role="form" action="/GuessMerlin" method="post">
			<input type="hidden" name="gameid" value="@Model.GameId" />
			<input type="hidden" name="playerGuid" value="@Model.PlayerGuid" />
			<div class="form-group">
				@Html.DropDownList("Guess", Model.GuessMerlinPlayersSelectList, new { @class = "form-control" })
			</div>
			<input class="btn btn-default" type="submit" value="Guess Merlin" />
		</form>
<<<<<<< HEAD
    }
    if (Model.Actions.Contains(ResistanceOnline.Core.Action.Type.UseTheLadyOfTheLake))
    {
        <form role="form" action="/LadyOfTheLake" method="post">
            <input type="hidden" name="gameid" value="@Model.GameId" />
            <input type="hidden" name="playerGuid" value="@Model.PlayerGuid" />
            <div class="form-group">
                @Html.DropDownList("Target", Model.LadyOfTheLakePlayerSelectList, new { @class = "form-control" })
            </div>
            <input class="btn btn-default" type="submit" value="Use Lady of the Lake" />
        </form>
    }
    if (Model.Actions.Contains(ResistanceOnline.Core.Action.Type.JoinGame))
    {
		if(User.Identity.IsAuthenticated)
		{
			<form role="form" action="/JoinGame" method="post">
				<input type="hidden" name="gameid" value="@Model.GameId" />
				<input class="btn btn-default" type="submit" value="Join Game" />
			</form>	
		}
		else
		{
			<p>Log in to join the game</p>
		}
		
    }
=======
	}

>>>>>>> attempt at binding widgets
    if (Model.Actions.Contains(ResistanceOnline.Core.Action.Type.AddToTeam))
    {
        <form role="form" action="/AddToTeam" method="post">
            <input type="hidden" name="playerGuid" value="@Model.PlayerGuid" />
            <input type="hidden" name="gameId" value="@Model.GameId" />
            <div class="form-group">
                @Html.DropDownList("Person", Model.AddToTeamPlayersSelectList, new { @class = "form-control" })
            </div>
            <input class="btn btn-default" type="submit" value="Add to Team" />
        </form>
    }
    if (Model.Actions.Contains(ResistanceOnline.Core.Action.Type.SubmitQuestCard))
    {
		<form role="form" action="/SubmitQuestCard" method="post">
			<input type="hidden" name="playerGuid" value="@Model.PlayerGuid" />
			<input type="hidden" name="gameid" value="@Model.GameId" />
			<div class="radio">
				<label>
					<input type="radio" name="success" value="true" />Success
				</label>
			</div>
			<div class="radio">
				<label>
					<input type="radio" name="success" value="false" />Fail
				</label>
			</div>
			<input class="btn btn-default" type="submit" value="Submit Quest Card" />
		</form>
    }
    if (Model.Actions.Contains(ResistanceOnline.Core.Action.Type.VoteForTeam))
    {
        <form role="form" action="/VoteForTeam" method="post">
            <input type="hidden" name="playerGuid" value="@Model.PlayerGuid" />
            <input type="hidden" name="gameid" value="@Model.GameId" />
            <div class="radio">
                <label>
                    <input type="radio" name="approve" value="true" />Accept
                </label>
            </div>
            <div class="radio">
                <label>
                    <input type="radio" name="approve" value="false" />Reject
                </label>
            </div>
            <input class="btn btn-default" type="submit" value="Vote for Team" />
        </form>
    }
}-->
<<<<<<< HEAD
=======
</ul>
>>>>>>> convert actions to widgets
=======
>>>>>>> more knockout
